{
  "hash": "06348134da5260306ed5c11cc3e284f0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Defining states by right-to-work status by year\"\nauthor: \"Emma Cohn\"\nformat: html\neditor: visual\nexecute: \n  eval: false\n---\n\n\n\n\nUse this code to define right-to-work versus non-right-to-work status for states by year, factoring in when states became or stopped being RTW. This code is best for running time series comparisons between RTW and non-RTW states. An example at the bottom of this page calculates RTW vs non-RTW prime age EPOPS over time using the [EPI CPS microdata extracts](https://economic.github.io/earn_code_library/epi_microdata.html).\n\n**Note:** This code requires the use of an additional csv file to assign the RTW vs non-RTW labels to each state. Download the file [here](https://s3.amazonaws.com/media.earn.us/files/state_rtw_definitions.csv) and save to your project before running code.\n\nThe following chunk of code loads the R libraries necessary for this exercise. You may need to install them to run this code.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Load necessary libraries\nlibrary(tidyverse)\nlibrary(epiextractr)\nlibrary(labelled)\n```\n:::\n\n\n\n\n## Import and clean data\n\n**Note:** Don't forget to **update years, file names,** and **file paths** to match your setup before running the script.\n\nIn this chunk, you'll reformat the RTW label **rtw_status_years.csv** file into a format that's easier to process in R.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read in RTW status by year\nrtw_status_year <- read.csv(\"./input/rtw_status_year.csv\") |> \n  pivot_longer(cols = -year, names_to = \"state\", values_to = \"rtw_status\") |> \n  arrange(state, year)\n```\n:::\n\n\n\n\nRunning this script chunk will call and clean the BLS Current Population Survey Basic data required to calculate prime age EPOPs. It will also join the `rtw_status_years` data frame you created to label each state as \"RTW\" or \"Non-RTW\" in a given year.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# import CPS Basic data\ncps_basic <- load_basic(2000:2025, \"year\", \"month\", \"selfemp\", \"selfinc\", \"age\", \"statefips\", \"emp\", \"lfstat\",\n              \"cow1\", \"female\", \"wbhao\", \"basicwgt\") |> \n  # Age restrictions\n  filter(age >= 16) |> \n  # identify prime-age (for EPOPs)\n  mutate(prime_age = case_when(between(age, 25, 54) ~ 1, TRUE ~ 0), state=to_factor(statefips)) |> \n  # merge RTW status\n  left_join(rtw_status_year, by = c(\"year\", \"state\")) |> \n  # adjust for missing Oct data\n  mutate(weight = case_match(year, \n                             2025 ~ basicwgt / 11, \n                             .default = basicwgt / 12))\n```\n:::\n\n\n\n\n## Run analysis\n\nHere you'll run the analysis to calculate prime age EPOPs by RTW vs. non-RTW states over time.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nepop_rtw <- cps_basic |> \n  filter(prime_age == 1) |> \n  # EPOP = weighted mean of employment\n  summarise(epop = weighted.mean(emp, w = weight, na.rm = TRUE), .by = c(year, rtw_status)) |> \n  # reshape wide by RTW label\n  pivot_wider(id_cols = year, names_from = rtw_status, values_from = epop) |> \n  rename(RTW = `1`, non_RTW = `0`)\n```\n:::\n\n\n\n\nAnd that's all! You can easily apply the first two code chunks to any CPS (or other survey) analysis you want to do.\n\nHappy coding!",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}