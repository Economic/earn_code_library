{
  "hash": "9c359a21d396dea813b2544af7e6cdbb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Load Census tables via Tidycensus\"\nauthor: \"Zane Mokhiber\"\n---\n\n\n\n\nThis script provides a few examples of how to load ACS tables from <https://data.census.gov> using the [Tidycensus](https://walker-data.com/tidycensus/index.html) package.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidycensus)\nlibrary(tidyverse)\n```\n:::\n\n\n\n\n**Note:** A census API key is required to use `tidycensus`. Register for a Census API key at <https://api.census.gov/data/key_signup.html>. Once you've obtained a key, you can copy it to your .Renviron file by using the `bls_set_key()` function.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#sets bls API key (optional but encouraged)\nbls_set_key(\"YOUR BLS API KEY HERE\")\n```\n:::\n\n\n\n\n## Explore available variables in the ACS 5-year sample\n\nUse the `load_variables()` function to load available tables derived from the 2021 ACS 5-year survey.\n\n-   See a full list of available Census tables at <https://www.census.gov/programs-surveys/acs/technical-documentation/table-shells.html>\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Show all available tables\n\nacs_2021_variables <- load_variables(2021, \"acs5\", cache = TRUE)\n\nacs_2021_variables\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 27,886 × 4\n   name        label                                    concept        geography\n   <chr>       <chr>                                    <chr>          <chr>    \n 1 B01001A_001 Estimate!!Total:                         SEX BY AGE (W… tract    \n 2 B01001A_002 Estimate!!Total:!!Male:                  SEX BY AGE (W… tract    \n 3 B01001A_003 Estimate!!Total:!!Male:!!Under 5 years   SEX BY AGE (W… tract    \n 4 B01001A_004 Estimate!!Total:!!Male:!!5 to 9 years    SEX BY AGE (W… tract    \n 5 B01001A_005 Estimate!!Total:!!Male:!!10 to 14 years  SEX BY AGE (W… tract    \n 6 B01001A_006 Estimate!!Total:!!Male:!!15 to 17 years  SEX BY AGE (W… tract    \n 7 B01001A_007 Estimate!!Total:!!Male:!!18 and 19 years SEX BY AGE (W… tract    \n 8 B01001A_008 Estimate!!Total:!!Male:!!20 to 24 years  SEX BY AGE (W… tract    \n 9 B01001A_009 Estimate!!Total:!!Male:!!25 to 29 years  SEX BY AGE (W… tract    \n10 B01001A_010 Estimate!!Total:!!Male:!!30 to 34 years  SEX BY AGE (W… tract    \n# ℹ 27,876 more rows\n```\n\n\n:::\n:::\n\n\n\n\n## Examples\n\n### Demographic data\n\nThis example loads demographic data from the 2017-2021 ACS for counties in Michigan.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# This option will retrieve geographic data from the Census\noptions(tigris_use_cache = TRUE)\n\n# Table B01001: Sex by Age\nMI_demographics <- get_acs(table = \"B01001\",\n                           geography = \"county\",\n                           year = 2021,\n                           state = \"MI\",\n                           survey = \"acs5\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGetting data from the 2017-2021 5-year ACS\n```\n\n\n:::\n\n```{.r .cell-code}\nMI_demographics\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4,067 × 5\n   GEOID NAME                    variable   estimate   moe\n   <chr> <chr>                   <chr>         <dbl> <dbl>\n 1 26001 Alcona County, Michigan B01001_001    10138    NA\n 2 26001 Alcona County, Michigan B01001_002     5127    38\n 3 26001 Alcona County, Michigan B01001_003      169    12\n 4 26001 Alcona County, Michigan B01001_004      176    40\n 5 26001 Alcona County, Michigan B01001_005      190    36\n 6 26001 Alcona County, Michigan B01001_006      132    12\n 7 26001 Alcona County, Michigan B01001_007       68    17\n 8 26001 Alcona County, Michigan B01001_008       28    20\n 9 26001 Alcona County, Michigan B01001_009       47    18\n10 26001 Alcona County, Michigan B01001_010      110    24\n# ℹ 4,057 more rows\n```\n\n\n:::\n:::\n\n\n\n\n### Map of median household income in MI, by county\n\nThis example creates a map of median household income in Michigan from the 2017-2021 ACS, by county.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot household income by county\nMI_income <- get_acs(\n  geography = \"county\", \n  state = \"MI\",\n  variables = \"B19013_001\",\n  year = 2021,\n  geometry = TRUE,\n)\n\nplot(MI_income[\"estimate\"])\n```\n\n::: {.cell-output-display}\n![](tidycensus_example_files/figure-html/Simple MI plot-1.png){width=672}\n:::\n:::\n\n\n\n\n### Map of median household income for Wayne County, MI, by tract\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndetroit_income <- get_acs(\n  geography = \"tract\", \n  state = \"MI\",\n  county = \"Wayne\",\n  variables = \"B19013_001\",\n  year = 2021,\n  geometry = TRUE,\n)\n\nplot(detroit_income[\"estimate\"])\n```\n\n::: {.cell-output-display}\n![](tidycensus_example_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n\n\n### Total income below poverty level in Rhode Island by gender, 2009--2021\n\nThis example defines function to load multiple years and multiple demographic groups for table b17001\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Poverty in Rhode Island: https://data.census.gov/table?q=B17001B\n\n#  Function to load multiple years of acs data\nload_acs_tables <- function(x){\n  get_acs(geography = \"state\", \n          variables = c(total_count = \"B17001_001\",  \n                        count_income_below_poverty = \"B17001_002\",  \n                        count_income_below_poverty_level_male = \"B17001_003\",  \n                        count_income_below_poverty_level_female = \"B17001_017\"), \n          state = \"RI\", \n          year = x, \n          output = \"wide\") %>% \n    #create year variable\n    mutate(year = x)\n}\n\n#load 2009:2018 5yr datasets with map_dfr()\nRI_Poverty_B <- map_dfr(2009:2021, load_acs_tables)\n\nRI_Poverty_B\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 13 × 11\n   GEOID NAME         total_countE total_countM count_income_below_povertyE\n   <chr> <chr>               <dbl>        <dbl>                       <dbl>\n 1 44    Rhode Island      1019380          497                      118618\n 2 44    Rhode Island      1014029          440                      123396\n 3 44    Rhode Island      1012044          459                      129454\n 4 44    Rhode Island      1011137          430                      133462\n 5 44    Rhode Island      1010872          463                      137244\n 6 44    Rhode Island      1012806          364                      143996\n 7 44    Rhode Island      1013455          398                      144223\n 8 44    Rhode Island      1013916          310                      140161\n 9 44    Rhode Island      1015923          402                      136126\n10 44    Rhode Island      1016029          462                      133055\n11 44    Rhode Island      1016506          463                      125826\n12 44    Rhode Island      1017028          481                      117785\n13 44    Rhode Island      1050314          707                      118257\n# ℹ 6 more variables: count_income_below_povertyM <dbl>,\n#   count_income_below_poverty_level_maleE <dbl>,\n#   count_income_below_poverty_level_maleM <dbl>,\n#   count_income_below_poverty_level_femaleE <dbl>,\n#   count_income_below_poverty_level_femaleM <dbl>, year <int>\n```\n\n\n:::\n:::\n\n\n\n\nA more complex function to load multiple demographic groups\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload_acs_tables2 <- function(x,y){\n  get_acs(geography = \"state\", \n          variables = c(total_count = paste0(\"B17001\",y,\"_001\"),  \n                        count_income_below_poverty = paste0(\"B17001\",y,\"_002\"),  \n                        count_income_below_poverty_level_male = paste0(\"B17001\",y,\"_003\"),  \n                        count_income_below_poverty_level_female = paste0(\"B17001\",y,\"_017\")), \n          state = \"RI\", \n          year = x, \n          output = \"wide\") %>% \n    #create variables to identify years and demographic groups\n    mutate(year = x,\n           group = y)\n}\n\n#create list of arguments to pass to function\ncrossargs <- expand.grid(x=2009:2021, y=LETTERS[1:9])\n\n#load all data 2009 to 2021\nRI_Poverty <- map2_dfr(crossargs$x, crossargs$y, load_acs_tables2)\n\nRI_Poverty\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 117 × 12\n   GEOID NAME         total_countE total_countM count_income_below_povertyE\n   <chr> <chr>               <dbl>        <dbl>                       <dbl>\n 1 44    Rhode Island       844002         2476                       74676\n 2 44    Rhode Island       832540         2445                       76711\n 3 44    Rhode Island       831102         2675                       80691\n 4 44    Rhode Island       827707         2583                       84578\n 5 44    Rhode Island       824245         3051                       86232\n 6 44    Rhode Island       825456         2895                       92849\n 7 44    Rhode Island       823532         2843                       93988\n 8 44    Rhode Island       822275         3089                       92245\n 9 44    Rhode Island       823518         3001                       89596\n10 44    Rhode Island       823420         2950                       89282\n# ℹ 107 more rows\n# ℹ 7 more variables: count_income_below_povertyM <dbl>,\n#   count_income_below_poverty_level_maleE <dbl>,\n#   count_income_below_poverty_level_maleM <dbl>,\n#   count_income_below_poverty_level_femaleE <dbl>,\n#   count_income_below_poverty_level_femaleM <dbl>, year <int>, group <fct>\n```\n\n\n:::\n:::\n\n\n\n\nSee more examples from Tidycensus at <https://walker-data.com/tidycensus/articles/basic-usage.html>\n",
    "supporting": [
      "tidycensus_example_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}